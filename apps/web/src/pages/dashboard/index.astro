---
import DashboardLayout from '../../layouts/DashboardLayout.astro';
import { getSupabaseClient } from '../../lib/supabase';

// Get the user's email from session
const accessToken = Astro.cookies.get('sb-access-token')?.value;
const refreshToken = Astro.cookies.get('sb-refresh-token')?.value;

let userEmail = '';

if (accessToken && refreshToken) {
  const supabase = getSupabaseClient();
  const { data } = await supabase.auth.setSession({
    access_token: accessToken,
    refresh_token: refreshToken,
  });
  userEmail = data.session?.user?.email || '';
}
---

<DashboardLayout title="Dashboard">
  <div class="dashboard-home">
    <div class="welcome-section">
      <h1>Welcome to Landing Page Generator</h1>
      <p class="user-email">Logged in as: <strong>{userEmail}</strong></p>
    </div>

    <div class="content-grid">
      <div class="card">
        <h2>Create New Landing Page</h2>
        <p>Fill out the form below to deploy a new landing page for your client.</p>
        <p style="color: #6b7280; margin-top: 12px;">Coming in Milestone 2!</p>
      </div>

      <div class="card">
        <h2>Your Deployments</h2>
        <p>View and manage all your deployed landing pages.</p>
        <p style="color: #6b7280; margin-top: 12px;">No deployments yet.</p>
      </div>
    </div>

    <div class="info-card card">
      <h3>Milestone 1 Complete! ✓</h3>
      <ul>
        <li>✓ Astro app with server-side rendering</li>
        <li>✓ Supabase magic link authentication</li>
        <li>✓ Protected dashboard routes</li>
        <li>✓ Dashboard layout and navigation</li>
      </ul>
      <p style="margin-top: 16px; color: #6b7280;">
        Next up: Database schema, RLS policies, and deployment form (M2)
      </p>
    </div>
  </div>

  <style>
    .dashboard-home {
      max-width: 900px;
      margin: 0 auto;
    }

    .welcome-section {
      margin-bottom: 40px;
    }

    .welcome-section h1 {
      margin-bottom: 8px;
      color: #111827;
    }

    .user-email {
      color: #6b7280;
    }

    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }

    .card h2 {
      margin-bottom: 12px;
      color: #111827;
      font-size: 20px;
    }

    .card h3 {
      margin-bottom: 16px;
      color: #111827;
    }

    .card p {
      color: #6b7280;
      line-height: 1.5;
    }

    .info-card {
      background: #f0f9ff;
      border: 1px solid #bae6fd;
    }

    .info-card ul {
      list-style: none;
      padding: 0;
    }

    .info-card li {
      padding: 8px 0;
      color: #0369a1;
    }
  </style>
</DashboardLayout>
